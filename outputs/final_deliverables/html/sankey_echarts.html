<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Sequential Screening Sankey Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 30px;
            font-family: 'Segoe UI', 'PingFang SC', sans-serif;
        }
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 30px;
            font-size: 28px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            max-width: 1500px;
            margin: 0 auto;
        }
        .chart-box {
            background: rgba(255,255,255,0.95);
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        .chart {
            width: 100%;
            height: 380px;
        }
        .chart-title {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 15px;
            font-weight: 600;
        }
        .metrics {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        .metric {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <h1>üî¨ Sequential Screening Algorithm - Sankey Flow</h1>
    
    <div class="container">
        <div class="chart-box">
            <div class="chart-title">Internal Test Set - M4‚ÜíM3</div>
            <div id="chart1" class="chart"></div>
            <div class="metrics">
                <span class="metric">Acc: 84%</span>
                <span class="metric">Sen: 86%</span>
                <span class="metric">NPV: 89%</span>
                <span class="metric">RA: 16%</span>
            </div>
        </div>
        <div class="chart-box">
            <div class="chart-title">Internal Test Set - M5‚ÜíM3</div>
            <div id="chart2" class="chart"></div>
            <div class="metrics">
                <span class="metric">Acc: 84%</span>
                <span class="metric">Sen: 77%</span>
                <span class="metric">NPV: 84%</span>
                <span class="metric">RA: 39%</span>
            </div>
        </div>
        <div class="chart-box">
            <div class="chart-title">Prospective Test Set - M4‚ÜíM3 ‚≠ê</div>
            <div id="chart3" class="chart"></div>
            <div class="metrics">
                <span class="metric">Acc: 86%</span>
                <span class="metric">Sen: 92%</span>
                <span class="metric">NPV: 94%</span>
                <span class="metric">RA: 25%</span>
            </div>
        </div>
        <div class="chart-box">
            <div class="chart-title">Prospective Test Set - M5‚ÜíM3</div>
            <div id="chart4" class="chart"></div>
            <div class="metrics">
                <span class="metric">Acc: 85%</span>
                <span class="metric">Sen: 87%</span>
                <span class="metric">NPV: 91%</span>
                <span class="metric">RA: 35%</span>
            </div>
        </div>
    </div>

    <script>
        function createSankey(containerId, data) {
            const chart = echarts.init(document.getElementById(containerId));
            
            const option = {
                tooltip: {
                    trigger: 'item',
                    formatter: function(params) {
                        if (params.dataType === 'node') {
                            return '<b>' + params.name + '</b>';
                        }
                        return params.data.source + ' ‚Üí ' + params.data.target + '<br/><b>n = ' + params.data.value + '</b>';
                    }
                },
                series: [{
                    type: 'sankey',
                    left: 50,
                    right: 120,
                    top: 20,
                    bottom: 20,
                    emphasis: {
                        focus: 'adjacency'
                    },
                    nodeAlign: 'justify',
                    orient: 'horizontal',
                    nodeGap: 10,
                    nodeWidth: 15,
                    data: data.nodes,
                    links: data.links,
                    lineStyle: {
                        color: 'gradient',
                        curveness: 0.5,
                        opacity: 0.4
                    },
                    label: {
                        position: 'right',
                        fontSize: 10,
                        color: '#333'
                    },
                    itemStyle: {
                        borderWidth: 0
                    }
                }]
            };
            
            chart.setOption(option);
        }

        // Internal M4‚ÜíM3
        const data1 = {
            nodes: [
                {name: 'Total\n(n=51)', itemStyle: {color: '#3498db'}},
                {name: 'Step1+\n(n=43)', itemStyle: {color: '#e74c3c'}},
                {name: 'Step1-\n(n=8)', itemStyle: {color: '#2ecc71'}},
                {name: 'Step2+\n(n=24)', itemStyle: {color: '#e67e22'}},
                {name: 'Step2-\n(n=19)', itemStyle: {color: '#27ae60'}},
                {name: 'TP (n=19)', itemStyle: {color: '#16a085'}},
                {name: 'FP (n=5)', itemStyle: {color: '#c0392b'}},
                {name: 'TN (n=7)', itemStyle: {color: '#27ae60'}},
                {name: 'FN (n=1)', itemStyle: {color: '#e74c3c'}}
            ],
            links: [
                {source: 'Total\n(n=51)', target: 'Step1+\n(n=43)', value: 43},
                {source: 'Total\n(n=51)', target: 'Step1-\n(n=8)', value: 8},
                {source: 'Step1+\n(n=43)', target: 'Step2+\n(n=24)', value: 24},
                {source: 'Step1+\n(n=43)', target: 'Step2-\n(n=19)', value: 19},
                {source: 'Step2+\n(n=24)', target: 'TP (n=19)', value: 19},
                {source: 'Step2+\n(n=24)', target: 'FP (n=5)', value: 5},
                {source: 'Step1-\n(n=8)', target: 'TN (n=7)', value: 7},
                {source: 'Step1-\n(n=8)', target: 'FN (n=1)', value: 1}
            ]
        };

        // Internal M5‚ÜíM3
        const data2 = {
            nodes: [
                {name: 'Total\n(n=51)', itemStyle: {color: '#3498db'}},
                {name: 'Step1+\n(n=31)', itemStyle: {color: '#e74c3c'}},
                {name: 'Step1-\n(n=20)', itemStyle: {color: '#2ecc71'}},
                {name: 'Step2+\n(n=20)', itemStyle: {color: '#e67e22'}},
                {name: 'Step2-\n(n=11)', itemStyle: {color: '#27ae60'}},
                {name: 'TP (n=17)', itemStyle: {color: '#16a085'}},
                {name: 'FP (n=3)', itemStyle: {color: '#c0392b'}},
                {name: 'TN (n=18)', itemStyle: {color: '#27ae60'}},
                {name: 'FN (n=2)', itemStyle: {color: '#e74c3c'}}
            ],
            links: [
                {source: 'Total\n(n=51)', target: 'Step1+\n(n=31)', value: 31},
                {source: 'Total\n(n=51)', target: 'Step1-\n(n=20)', value: 20},
                {source: 'Step1+\n(n=31)', target: 'Step2+\n(n=20)', value: 20},
                {source: 'Step1+\n(n=31)', target: 'Step2-\n(n=11)', value: 11},
                {source: 'Step2+\n(n=20)', target: 'TP (n=17)', value: 17},
                {source: 'Step2+\n(n=20)', target: 'FP (n=3)', value: 3},
                {source: 'Step1-\n(n=20)', target: 'TN (n=18)', value: 18},
                {source: 'Step1-\n(n=20)', target: 'FN (n=2)', value: 2}
            ]
        };

        // Prospective M4‚ÜíM3
        const data3 = {
            nodes: [
                {name: 'Total\n(n=100)', itemStyle: {color: '#3498db'}},
                {name: 'Step1+\n(n=75)', itemStyle: {color: '#e74c3c'}},
                {name: 'Step1-\n(n=25)', itemStyle: {color: '#2ecc71'}},
                {name: 'Step2+\n(n=47)', itemStyle: {color: '#e67e22'}},
                {name: 'Step2-\n(n=28)', itemStyle: {color: '#27ae60'}},
                {name: 'TP (n=36)', itemStyle: {color: '#16a085'}},
                {name: 'FP (n=11)', itemStyle: {color: '#c0392b'}},
                {name: 'TN (n=24)', itemStyle: {color: '#27ae60'}},
                {name: 'FN (n=1)', itemStyle: {color: '#e74c3c'}}
            ],
            links: [
                {source: 'Total\n(n=100)', target: 'Step1+\n(n=75)', value: 75},
                {source: 'Total\n(n=100)', target: 'Step1-\n(n=25)', value: 25},
                {source: 'Step1+\n(n=75)', target: 'Step2+\n(n=47)', value: 47},
                {source: 'Step1+\n(n=75)', target: 'Step2-\n(n=28)', value: 28},
                {source: 'Step2+\n(n=47)', target: 'TP (n=36)', value: 36},
                {source: 'Step2+\n(n=47)', target: 'FP (n=11)', value: 11},
                {source: 'Step1-\n(n=25)', target: 'TN (n=24)', value: 24},
                {source: 'Step1-\n(n=25)', target: 'FN (n=1)', value: 1}
            ]
        };

        // Prospective M5‚ÜíM3
        const data4 = {
            nodes: [
                {name: 'Total\n(n=100)', itemStyle: {color: '#3498db'}},
                {name: 'Step1+\n(n=65)', itemStyle: {color: '#e74c3c'}},
                {name: 'Step1-\n(n=35)', itemStyle: {color: '#2ecc71'}},
                {name: 'Step2+\n(n=44)', itemStyle: {color: '#e67e22'}},
                {name: 'Step2-\n(n=21)', itemStyle: {color: '#27ae60'}},
                {name: 'TP (n=34)', itemStyle: {color: '#16a085'}},
                {name: 'FP (n=10)', itemStyle: {color: '#c0392b'}},
                {name: 'TN (n=32)', itemStyle: {color: '#27ae60'}},
                {name: 'FN (n=3)', itemStyle: {color: '#e74c3c'}}
            ],
            links: [
                {source: 'Total\n(n=100)', target: 'Step1+\n(n=65)', value: 65},
                {source: 'Total\n(n=100)', target: 'Step1-\n(n=35)', value: 35},
                {source: 'Step1+\n(n=65)', target: 'Step2+\n(n=44)', value: 44},
                {source: 'Step1+\n(n=65)', target: 'Step2-\n(n=21)', value: 21},
                {source: 'Step2+\n(n=44)', target: 'TP (n=34)', value: 34},
                {source: 'Step2+\n(n=44)', target: 'FP (n=10)', value: 10},
                {source: 'Step1-\n(n=35)', target: 'TN (n=32)', value: 32},
                {source: 'Step1-\n(n=35)', target: 'FN (n=3)', value: 3}
            ]
        };

        createSankey('chart1', data1);
        createSankey('chart2', data2);
        createSankey('chart3', data3);
        createSankey('chart4', data4);
    </script>
</body>
</html>
